<div *transloco="let t" class="d-flex flex-column pb-2">
  <span *ngIf="label" [id]="labelId" class="czls-title">{{ label }} {{ required ? '*' : '' }}</span>

  <cz-input
    *ngIf="canBeFiltered"
    [ngClass]="!inputLabel ? 'compact-form-field mb-3' : null"
    [formControl]="searchControl"
    [label]="inputLabel"
    [ariaLabel]="inputAriaLabel"
  >
    <ng-template #czSuffix>
      <button
        *ngIf="searchControl.value"
        [id]="inputClearBtnId"
        mat-icon-button
        [attr.aria-labelledby]="getClearBtnLabelledBy()"
        (click)="searchControl.setValue(null)"
      >
        <mat-icon>close</mat-icon>
        <span class="sr-only">{{ inputClearLabel }}</span>
      </button>
    </ng-template>
  </cz-input>
  <ng-container
    *ngFor="let group of optionsGroups | selectOptionGroupsSlice: actualSeeMoreThreshold:model; let isLast = last; trackBy: trackByGroup"
  >
    <ng-container *ngIf="group.options | selectOptionsSort: sortType as actualOptions">
      <span *ngIf="canBeFiltered" aria-live="polite" aria-atomic="true" class="sr-only">{{
        t('global.filter_count', { count: actualOptions.length })
      }}</span>
      <div
        class="checkboxes-container"
        [class.flex-column]="direction === 'column'"
        role="group"
        [attr.aria-labelledby]="groupAriaLabelledBy"
      >
        <ng-container *ngFor="let option of actualOptions; trackBy: trackBySelectOption">
          <div class="d-flex justify-content-between align-items-center checkbox-container">
            <mat-checkbox [class.mr-4]="direction === 'row'" [checked]="isChecked(option)" (change)="onChange($event, option)">
              <ng-container [ngTemplateOutlet]="template || defaultTemplate" [ngTemplateOutletContext]="getContext(option)"></ng-container>
            </mat-checkbox>
          </div>
        </ng-container>
      </div>

      <ng-template #defaultTemplate let-option>
        <ng-container *ngIf="isString(option.label); else langStringTemplate">{{ t(option.label) }}</ng-container>
        <ng-template #langStringTemplate>{{ option.label | czLabel }} </ng-template>

        <span *ngIf="counts">({{ counts[option.value] || 0 }})</span>
      </ng-template>
    </ng-container>
    <mat-divider *ngIf="!isLast" class="mt-3"></mat-divider>
  </ng-container>
  <button *ngIf="canSeeMore" type="button" mat-button (click)="toggleSeeMore()">
    <ng-container *ngIf="!seeMore">+{{ getSeeMoreCount() }}</ng-container>
    {{ t(seeMore ? 'global.see_less' : 'global.see_more') }}
  </button>
</div>
